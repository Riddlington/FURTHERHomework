-- List authors and their books
SELECT 
  a.id,
  a.first_name,
  a.last_name,
  c.name AS country_name,
  b.title AS book_name,
  b.isbn,
  bd.price,
  bd.discount,
  bd.is_hard_copy
FROM author a
LEFT JOIN country c ON a.country_id = c.id
LEFT JOIN book b ON a.id = b.author_id
LEFT JOIN bookdetails bd ON b.id = bd.book_id
ORDER BY a.last_name, a.first_name;

-- Authors from US
SELECT 
  a.id,
  a.first_name,
  a.last_name,
  c.name AS country_name
FROM author a
JOIN country c ON a.country_id = c.id
WHERE c.code = 'USA';

-- Authors with books, ordered by book count
SELECT 
  a.id,
  a.first_name,
  a.last_name,
  c.name AS country_name,
  COUNT(b.id) AS book_count
FROM author a
JOIN country c ON a.country_id = c.id
JOIN book b ON a.id = b.author_id
GROUP BY a.id, a.first_name, a.last_name, c.name
ORDER BY book_count DESC;

-- Count of books by US authors
SELECT COUNT(b.id) AS books_by_usa_authors
FROM book b
JOIN author a ON b.author_id = a.id
JOIN country c ON a.country_id = c.id
WHERE c.code = 'USA';

-- Books with discount between 20 and 30
SELECT 
  b.title,
  b.isbn,
  bd.discount,
  bd.price
FROM book b
JOIN bookdetails bd ON b.id = bd.book_id
WHERE bd.discount BETWEEN 20 AND 30
ORDER BY bd.price ASC;

-- Cheapest book per author
SELECT 
  a.first_name,
  a.last_name,
  COALESCE(MIN(bd.price), -1) AS cheapest_price
FROM author a
LEFT JOIN book b ON a.id = b.author_id
LEFT JOIN bookdetails bd ON b.id = bd.book_id
GROUP BY a.id, a.first_name, a.last_name;
